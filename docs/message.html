<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body class="message-screen">
    <div class="container">
        <div class="envelope-animation">üíå</div>

        <h1>–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h1>
        <p class="message-instruction">–ù–∞–ø–∏—à–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å, —á—Ç–æ —è –Ω–∞–π–¥—É –∏ –ø—Ä–æ—á–∏—Ç–∞—é –ø–æ–∑–∂–µ</p>

        <form id="message-form" class="message-form">
            <div class="form-group">
                <label for="secret-message">–¢–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                <textarea id="secret-message" name="message" placeholder="–ù–∞–ø–∏—à–∏ –∑–¥–µ—Å—å –≤—Å—ë, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–∫–∞–∑–∞—Ç—å..." minlength="5" required></textarea>
                <div class="char-count">–°–∏–º–≤–æ–ª–æ–≤: <span id="char-counter">0</span></div>
            </div>

            <div class="form-options-grid">
                <button type="submit" class="btn btn-submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                <a href="final.html" class="btn btn-return">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</a>
            </div>
        </form>

        <div id="message-feedback" class="feedback"></div>

        <div class="romantic-quote">
            <p>–ª—é–±–ª—é —Ç–µ–±—è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ</p>
        </div>

        <div class="hearts-small">
            <span>‚ù§Ô∏è</span>
            <span>üíñ</span>
            <span>üíï</span>
            <span>üíó</span>
            <span>üíì</span>
        </div>
    </div>

    <script src="static/js/script.js"></script>
    <script>
        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        const textarea = document.getElementById('secret-message');
        const charCounter = document.getElementById('char-counter');

        textarea.addEventListener('input', function() {
            charCounter.textContent = this.value.length;

            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Å—á–µ—Ç—á–∏–∫–∞
            if (this.value.length < 10) {
                charCounter.style.color = '#ff6666';
            } else if (this.value.length < 30) {
                charCounter.style.color = '#ff9966';
            } else {
                charCounter.style.color = '#66cc66';
            }
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('message-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const message = textarea.value.trim();
            const feedback = document.getElementById('message-feedback');

            if (message.length < 5) {
                feedback.innerHTML = '<p class="wrong-feedback">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã 5 —Å–∏–º–≤–æ–ª–æ–≤</p>';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
            feedback.innerHTML = '<p class="loading">–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...</p>';

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage (—É–¥–∞–ª–µ–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –≤—ã–∑–æ–≤)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    feedback.innerHTML = '<p class="correct-feedback">–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –Ø –Ω–∞–π–¥—É –µ–≥–æ –∏ –ø—Ä–æ—á–∏—Ç–∞—é —Å —É–ª—ã–±–∫–æ–π. –°–ø–∞—Å–∏–±–æ!</p>';
                    textarea.value = '';
                    charCounter.textContent = '0';

                    // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è
                    setTimeout(() => {
                        feedback.innerHTML += '<p><a href="{{ url_for("final") }}" class="btn-small">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏</a></p>';
                    }, 3000);
                } else {
                    feedback.innerHTML = '<p class="wrong-feedback">–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑</p>';
                }
            })
            .catch(error => {
                feedback.innerHTML = '<p class="wrong-feedback">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</p>';
            });
        });

        // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞
        const envelope = document.querySelector('.envelope-animation');
        setInterval(() => {
            envelope.style.transform = 'scale(1.1)';
            setTimeout(() => {
                envelope.style.transform = 'scale(1)';
            }, 300);
        }, 2000);
    </script>
<script src="static/js/static_version.js"></script>
</body>
</html>